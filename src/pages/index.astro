---
import dayjs from "dayjs"

import Main from "../layouts/main.astro"
import IndexHeader from "../components/index-header.astro"
import Star from "../components/star.astro"

const { DATE_FORMAT, MAX_RATING } = import.meta.env

const posts = await Astro.glob("../content/posts/*.md")
console.log(posts.length)
---
<Main>
	<IndexHeader />

	<main class="primary-main">
		<div class="wrapper container-q container-q-primary-main | flow mx-auto p-4">
			<div class="card-grid">
				{posts.map(({ slug, frontmatter }: any) => {
					const { title, date, rating, location, images }: any = frontmatter

					const className: string = rating === Number(MAX_RATING) ? `card card-top-rated` : `card`

					const stars: any[] = []
					for (let i = 0; i < rating; ++i) {
						stars.push(<Star />)
					}

					return (
					<>
					<a href={`/posts/${slug}`} class={className}>
						<div class="card__images">
							{images.map(({ src, alt }: any) => <img src={`/src/assets/images/${src}`} alt={alt}>)}
						</div><!-- ./card__images -->

						<div class="card__body | flow mt-4">
							<h2 class="text-2xl font-bold">{title}</h2>

							<div class="card__rating">
								{stars.map(( star: any ) => star)}
							</div><!-- card__rating -->

							<div class="card__content">
								<div class="card__content__icon">
									<i class="fa-duotone fa-earth-asia"></i>
								</div><!-- ./card__content__icon -->
								<div class="card__content__content">
									{location.join(", ")}
								</div>
							</div><!-- ./card__content__content -->

							<div class="card__content">
								<div class="card__content__icon">
									<i class="fa-duotone fa-calendar"></i>
								</div><!-- ./card__content__icon -->
								<div class="card__content__content">
									{dayjs(date).format(DATE_FORMAT)}
								</div>
							</div><!-- ./card__content__content -->
						</div><!-- ./card__body -->
					</a>
					</>
					)
				})}
			</div>
		</div>
	</main>
</Main>